#!/usr/bin/make -f
#
# debian/rules for Ubuntu linux-firmware
#
# Use this however you want, just give credit where credit is due.
#
# Copyright (c) 2008 Ben Collins <bcollins@ubuntu.com>
#
# Example build for a specific arch:
#	fakeroot debian/rules binary-arch arch=i386 flavours="generic"
#

# This is the debhelper compatability version to use.
export DH_COMPAT=4
export LC_ALL=C
export SHELL=/bin/bash -e


binary-arch:
build-arch:

build-indep:

firm_dir = $(CURDIR)/debian/linux-firmware/lib/firmware
u_firm_dir = $(CURDIR)/debian/nic-firmware/lib/firmware

install-indep: build-indep
	dh_testdir
	dh_testroot
	dh_clean -k -i

	install -d $(firm_dir)

	cp -a firmware/zd1211 $(firm_dir)/
	cp -a firmware/acx $(firm_dir)/
	for i in firmware/*/[[:lower:]]*; do \
	  case $${i##*/} in \
	    zd121*) ;; \
	    *) test -f "$$i" && cp $$i "$(firm_dir)/${i##*/}";; \
	  esac; \
	done

	for f in $$(cat debian/firmware.lst); do \
		install -m644 -D $$(find firmware -name $$f) $(u_firm_dir)/$$f; \
	done

binary-indep: install-indep
	dh_testdir
	dh_testroot

	dh_installchangelogs -i
	dh_installdocs -i
	dh_compress -i
	dh_fixperms -i
	dh_installdeb -i
	dh_gencontrol -i
	dh_md5sums -i
	dh_builddeb -i

binary: binary-indep binary-arch
build: build-arch build-indep

clean:
	dh_testdir
	dh_testroot
	dh_clean
